<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Traitify Widgets</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,minimal-ui">
  </head>
  <body>
    <div id="slide-deck"></div>
    <div id="results"></div>
    <script src="/build/traitify.js"></script>
    <script>
      Traitify.setPublicKey("sptoechv411aqbqrp4l9a4eg2a");
      Traitify.setHost("https://api.traitify.com");

      function initDeck (){
        var assessment = Traitify.ui.locale("en-us").assessmentId(localStorage.getItem("assessment-id"));
        assessment.targets({
          "SlideDeck": "#slide-deck",
          "Results": "#results"
        });
        assessment.allowBack(true);
        assessment.allowFullScreen(true);
        assessment.perspective("thirdPerson");
        assessment.on("personalitytypes.initialized", function(){
          console.log("personalitytypes!")
        })
        assessment.on("PersonalityTypes.initialized", function(){
          console.log("PersonalityTypes!")
        })
        widget = assessment.render()
        widget.catch(function(error){
          console.log(error)
        });
      }

      function createAssessment(){
        Traitify.post("/assessments", {deck_id: document.querySelector("#deck-name").value, locale_key: "en-us"}).then(function(assessment){
          try{
            localStorage.setItem("assessment-id", assessment.id);
          }catch(error){
            console.log(error);
          }
          initDeck();
        })
      }

      if(localStorage.getItem("assessment-id")){
        initDeck();
      }
    </script>

    <select id="deck-name">
      <option value="career-deck">Career Deck</option>
      <option value="persuasion">Persuasion</option>
      <option value="big-five-classic">The Big Five</option>
    </select>

    <button onclick="createAssessment()">New Assessment</button>
  </body>
</html>
